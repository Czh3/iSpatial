---
title: "introduction"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# load package
```{r setup}
#devtools::install_github("Czh3/iSpatial")
library(iSpatial)
```

# infer merFISH data:
```{r example}
# scRNA-seq data
data(NA_scRNA)

# merFISH data
data(NA_merFISH)

# infer spatial transcriptome
MSN_merFISH_iSpatial = iSpatial(NA_merFISH, NA_scRNA)

MSN_merFISH_iSpatial

# Gene "Acbd7" is not in the merFISH targeted genes
"Acbd7" %in% rownames(MSN_merFISH)

# After inferring, we can get the spatial expression of Acbd7
SpatialFeaturePlot(MSN_merFISH_iSpatial, features = "Acbd7", stroke=0.1, slot="data") +
  theme(legend.position = "right") +
  scale_fill_gradientn(colours = c(rainbow(10)[5:10], "red"))

# Find spatial variable genes
SVGs_infer = spatial_variable_genes(MSN_merFISH_iSpatial, "enhanced", bin = 20, n.core = 10)
SVGs_infer_sig = SVGs_infer[SVGs_infer$p.value < 0.001, ]

# cluster genes based on spatial expression pattern
gene_cluster = cluster_spatial_expr_pattern(MSN_merFISH_iSpatial, "enhanced", 
                             feature = SVGs_infer_sig$gene, n.cluster = 20,
                             ncol.plot = 4, bin = 20, n.core = 10)

# genes in cluster 3
names(gene_cluster[gene_cluster==3])

# plot
spatial_signature_plot(MSN_merFISH_iSpatial, names(gene_cluster[gene_cluster==3]), "Class 3")

```
